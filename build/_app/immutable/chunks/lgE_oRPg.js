import{at as h,h as w,au as A,av as E,aw as L}from"./BsruwuOw.js";import{i as x,a as T,p as k,b as H}from"./Q81dLJFU.js";function S(t,r,s){h(()=>{var n=w(()=>r(t,s?.())||{});if(s&&n?.update){var a=!1,o={};A(()=>{var e=s();E(e),a&&L(o,e)&&(o=e,n.update(e))}),a=!0}if(n?.destroy)return()=>n.destroy()})}function M(t){const r=JSON.parse(t);return r.data&&(r.data=k(r.data,H.decoders)),r}function u(t){return HTMLElement.prototype.cloneNode.call(t)}function g(t,r=()=>{}){const s=async({action:a,result:o,reset:e=!0,invalidateAll:c=!0})=>{o.type==="success"&&(e&&HTMLFormElement.prototype.reset.call(t),c&&await x()),(location.origin+location.pathname===a.origin+a.pathname||o.type==="redirect"||o.type==="error")&&await T(o)};async function n(a){if((a.submitter?.hasAttribute("formmethod")?a.submitter.formMethod:u(t).method)!=="post")return;a.preventDefault();const e=new URL(a.submitter?.hasAttribute("formaction")?a.submitter.formAction:u(t).action),c=a.submitter?.hasAttribute("formenctype")?a.submitter.formEnctype:u(t).enctype,p=new FormData(t,a.submitter),d=new AbortController;let f=!1;const y=await r({action:e,cancel:()=>f=!0,controller:d,formData:p,formElement:t,submitter:a.submitter})??s;if(f)return;let l;try{const i=new Headers({accept:"application/json","x-sveltekit-action":"true"});c!=="multipart/form-data"&&i.set("Content-Type",/^(:?application\/x-www-form-urlencoded|text\/plain)$/.test(c)?c:"application/x-www-form-urlencoded");const b=c==="multipart/form-data"?p:new URLSearchParams(p),m=await fetch(e,{method:"POST",headers:i,cache:"no-store",body:b,signal:d.signal});l=M(await m.text()),l.type==="error"&&(l.status=m.status)}catch(i){if(i?.name==="AbortError")return;l={type:"error",error:i}}await y({action:e,formData:p,formElement:t,update:i=>s({action:e,result:l,reset:i?.reset,invalidateAll:i?.invalidateAll}),result:l})}return HTMLFormElement.prototype.addEventListener.call(t,"submit",n),{destroy(){HTMLFormElement.prototype.removeEventListener.call(t,"submit",n)}}}export{S as a,g as e};
